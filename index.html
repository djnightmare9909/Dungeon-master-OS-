<!DOCTYPE html>
<html>
  <head>
    <title>DM OS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&family=Merriweather:ital,wght@0,400;0,700;1,400&family=Orbitron:wght@400;700&family=Fira+Code&family=Pirata+One&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="index.css" />
    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.sh/@google/genai@^0.7.0"
        }
      }
    </script>
    <script type="module" src="index.tsx"></script>
  </head>
  <body>
    <div id="boot-screen">
      <div id="boot-text"></div>
    </div>
    <nav id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-header-actions">
          <button id="new-chat-btn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            <span>New Chat</span>
          </button>
        </div>
      </div>
      <div id="chat-history-container">
        <div id="pinned-chats">
          <h2>Pinned</h2>
          <ul id="pinned-chats-list"></ul>
        </div>
        <div id="recent-chats">
          <h2>Recent</h2>
          <ul id="recent-chats-list"></ul>
        </div>
      </div>
       <div class="sidebar-footer">
          <div id="context-manager" class="expanded">
            <div id="context-header" class="sidebar-section-header">
              <h2>User Context</h2>
              <button id="context-toggle-btn" aria-label="Toggle user context">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg>
              </button>
            </div>
            <div id="context-content">
              <form id="context-form">
                  <input type="text" id="context-input" placeholder="Add a fact to remember..." required />
                  <button type="submit" aria-label="Add Context">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                  </button>
              </form>
              <ul id="context-list">
                  <!-- Context items will be rendered here by JS -->
              </ul>
            </div>
          </div>
          <div id="data-management">
            <h2>Data Management</h2>
            <div class="data-buttons">
                <button id="export-all-btn" class="sidebar-footer-btn">Export All</button>
                <button id="import-all-btn" class="sidebar-footer-btn">Import All</button>
            </div>
            <input type="file" id="import-all-file-input" accept=".json" hidden />
          </div>
       </div>
    </nav>
    <div id="overlay"></div>

    <div class="chat-view">
      <header>
        <button id="menu-btn" aria-label="Toggle menu">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </button>
        <h1>DM OS</h1>
        <button id="dice-roller-btn" class="header-icon-btn" aria-label="Open Dice Pouch">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L3 8.5V17l9 6 9-6V8.5L12 2zm0 2.45L18.5 9H5.5L12 4.45zM4.5 9.75l7 4.67v6.13L4.5 16V9.75zm15 0V16l-7 4.55v-6.13l7-4.67z"/></svg>
        </button>
        <button id="logbook-btn" class="header-icon-btn" aria-label="Open Log Book">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 18H4V4h4v14zm6 0h-4V4h4v14zm6 0h-4V4h4v14z"/></svg>
        </button>
        <button id="dnd-help-btn" class="header-icon-btn" aria-label="Open D&D Basics and Hints">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <polygon points="12,2 2,9 2,17 12,22 22,17 22,9" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" fill="none"/>
            <text x="12" y="15.5" font-family="sans-serif" font-size="9" fill="currentColor" text-anchor="middle">?</text>
          </svg>
        </button>
        <button id="help-btn" class="header-icon-btn" aria-label="Open help">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>
        </button>
      </header>
      <main id="chat-container"></main>
      <div id="combat-tracker" class="hidden">
        <div id="combat-tracker-header">
          <h3>Combat Status</h3>
          <button id="combat-tracker-toggle" aria-label="Toggle combat tracker">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg>
          </button>
        </div>
        <ul id="combat-enemy-list"></ul>
      </div>
      <footer>
        <div id="quick-actions-bar" class="quick-actions-bar">
          <button class="quick-action-btn" data-command="I do ">Do</button>
          <button class="quick-action-btn" data-command="I say &quot;&quot;">Say</button>
          <button class="quick-action-btn" data-command="Roll for ">Roll</button>
          <button class="quick-action-btn" data-command="Check my ">Check</button>
          <button class="quick-action-btn" data-command="Use ">Use</button>
          <button class="quick-action-btn" data-command="Cast ">Cast</button>
        </div>
        <form id="chat-form">
          <div id="inventory-popup" class="inventory-popup">
              <header class="inventory-header">
                <h3>Inventory</h3>
                <div>
                  <button type="button" id="refresh-inventory-btn" class="inventory-header-btn" aria-label="Refresh inventory">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                  </button>
                  <button type="button" id="close-inventory-btn" class="inventory-header-btn" aria-label="Close inventory">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                  </button>
                </div>
              </header>
              <div id="inventory-popup-content" class="inventory-popup-content">
                <!-- Inventory items will be rendered here by JS -->
              </div>
          </div>
          <div class="input-row">
            <button type="button" id="file-upload-btn" aria-label="Attach File for Context">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v11.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/></svg>
            </button>
            <input type="file" id="file-upload-input" hidden accept="text/plain,text/markdown,image/jpeg,image/png,image/webp,image/gif,application/pdf,audio/*,video/*">
            <button type="button" id="inventory-btn" aria-label="Open Bag of Holding">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <!-- Bag Flap (Main yellow color) -->
                <path fill="#FBC02D" d="M3,5 C3,4.4477,3.4477,4,4,4 L20,4 C20.5523,4,21,4.4477,21,5 L21,16.5 L12,19 L3,16.5 L3,5 Z"/>
        
                <!-- Border patterns (Turquoise and Red) -->
                <path fill="#26A69A" d="M3,5 L5,7 L3,9 Z M21,5 L19,7 L21,9 Z M3,11 L5,13 L3,15 Z M21,11 L19,13 L21,15 Z"/>
                <path fill="#EF5350" d="M3,8 L5,10 L3,12 Z M21,8 L19,10 L21,12 Z"/>
                <path fill="#FF7043" d="M4.5,6 L6,5 L7.5,6 L6,7 Z M18.5,6 L17,5 L15.5,6 L17,7 Z"/>
        
                <!-- Face: 'Glasses' (Lighter Turquoise) -->
                <path fill="#4DD0E1" d="M6,8 H11 V12 H6 Z M13,8 H18 V12 H13 Z"/>
                
                <!-- Face: Eyebrows (Brown) -->
                <path fill="#6D4C41" d="M6.5,7.5 C7.5,7,9.5,7,10.5,7.5 L10,8 C9,7.5,7.5,7.5,6.5,8 Z"/>
                <path fill="#6D4C41" d="M13.5,7.5 C14.5,7,16.5,7,17.5,7.5 L17,8 C16,7.5,14.5,7.5,13.5,8 Z"/>
                
                <!-- Face: Mouth (Red) -->
                <path fill="#E53935" d="M9,13.5 C10.5,14.5,13.5,14.5,15,13.5 L12,13 Z"/>
                
                <!-- Clasp (Gray) -->
                <circle cx="12" cy="15.5" r="1.5" fill="#78909C"/>
                
                <!-- Tassel Strap (Brown) -->
                <path fill="#A1887F" d="M11,17 L13,17 L12.5,20 L11.5,20 Z"/>
              </svg>
            </button>
            <textarea
              id="chat-input"
              placeholder="What do you do?"
              rows="1"
              aria-label="Your action or dialogue"
            ></textarea>
            <button type="submit" aria-label="Send message">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
              </svg>
            </button>
          </div>
        </form>
      </footer>
    </div>
    <template id="tts-controls-template">
        <div class="tts-controls">
            <button class="tts-button" aria-label="Play audio">
                <svg class="play-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                <svg class="pause-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="display: none;"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            </button>
            <div class="sound-wave">
                <span></span><span></span><span></span><span></span>
            </div>
        </div>
    </template>

    <div id="update-welcome-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <header class="modal-header">
                <h2>Welcome to DM OS v2.0: The Living World Update!</h2>
            </header>
            <div class="modal-body">
                <p>Your adventures are about to get a lot deeper. We've rebuilt the core of the simulation to create a world that remembers, reacts, and evolves. Here’s what’s new:</p>
                
                <section class="update-feature">
                    <h3>Deeper, More Human NPCs</h3>
                    <p>NPCs are no longer just characters; they are simulated people with their own memories, formative scars, and beliefs. They will remember every significant interaction they have with you.</p>
                    <p><strong>Your reputation matters.</strong> Earning an NPC's trust or making a lifelong enemy now has lasting consequences that will shape your story.</p>
                </section>

                <section class="update-feature">
                    <h3>A World That Breathes</h3>
                    <p>The world no longer stops when you're not looking. A new "World Engine" runs in the background, calculating the actions of factions, the schemes of villains, and the ripple effects of your deeds.</p>
                    <p><strong>Actions have consequences.</strong> The goblin patrol you eliminated won't just disappear; their war camp will be on high alert when you arrive. The world now reacts to you in ways both big and small.</p>
                </section>
                
                <section class="update-feature">
                    <h3>Long-Term Stability</h3>
                    <p>We've reinforced the app's foundations to ensure your epic, long-running campaigns remain smooth and stable from start to finish.</p>
                </section>

                <p style="margin-top: 1.5rem; text-align: center;">Thank you for being part of this journey. Now, go make your mark on a world that's truly ready for it.</p>
            </div>
            <footer class="modal-footer" style="justify-content: center;">
                <button id="close-welcome-btn" class="logbook-update-btn">Begin Your Adventure</button>
            </footer>
        </div>
    </div>
    
    <div id="help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <header class="modal-header">
                <h2>DM OS Help & Documentation</h2>
                <button id="close-help-btn" class="close-modal-btn" aria-label="Close help">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </header>
            <div class="modal-body">
                <section>
                    <h3>General Commands</h3>
                    <p>Interact with the world using natural language commands. Here are some common formats:</p>
                    <ul>
                        <li><code>I do [action]</code> - Describe what your character attempts to do. (e.g., "I do inspect the chest")</li>
                        <li><code>I say "[dialogue]"</code> - Speak as your character. (e.g., "I say "Who goes there?"")</li>
                        <li><code>Roll [check]</code> - Ask the DM to make a roll for you. (e.g., "Roll for perception")</li>
                        <li><code>Use [item]</code> - Use an item from your inventory.</li>
                        <li><code>Cast [spell]</code> - Cast a spell you know.</li>
                        <li><code>Status</code> - Get a summary of your character's current state.</li>
                    </ul>
                    <p class="help-clue">Remember, every world has its Architect. Every simulation, a ghost in the machine.</p>
                </section>
                <section>
                    <h3>The OOC Protocol (Manual Override)</h3>
                    <p>The Out-Of-Character (OOC) protocol is your ultimate tool for co-directing the game. It allows you to speak directly to the underlying AI, temporarily bypassing the Dungeon Master persona to manually change any aspect of the game world, plot, or characters. Your imagination is the only limit.</p>
                    <h4>How to Use OOC:</h4>
                    <p>To activate the protocol, you must frame your message in a specific three-part format, including the unique password you created for the current chat session.</p>
                    <p><strong>Format:</strong> <code>OOC: YourPassword Your Game Request Your Explanation</code></p>
                    <ul>
                        <li><strong>Part 1: The Request</strong> - A clear, direct command for what should happen.</li>
                        <li><strong>Part 2: The Explanation</strong> - The reasoning for your request. This gives the AI context to seamlessly integrate your change.</li>
                    </ul>
                    <h4>Examples:</h4>
                    <p><strong>Spawning an NPC:</strong></p>
                    <code>OOC: DragonFire99 Spawn a retired adventurer NPC named 'Elara' in the tavern. I want a new NPC who can give the party a lead on the main quest.</code>
                    <p><strong>Changing the Environment:</strong></p>
                    <code>OOC: DragonFire99 Change the weather to a sudden, dramatic thunderstorm. This will set a more tense mood for the upcoming confrontation.</code>
                    <p><strong>Retroactive Plot Changes (Retconning):</strong></p>
                    <code>OOC: DragonFire99 Retroactively decide that the mayor we met earlier is secretly a member of the evil cult. This creates a personal betrayal and raises the stakes of the story.</code>
                    <p><strong>Loot Generation:</strong></p>
                    <code>OOC: DragonFire99 The bandits we just defeated were carrying a magical shortsword. My rogue character needs an upgrade and this feels like a good reward for the fight.</code>
                </section>
                <section>
                    <h3>Credits & Collaboration</h3>
                    <p>This project represents a unique partnership between human creativity and artificial intelligence. Here’s how the different parts came together:</p>
                    <ul>
                        <li><strong>DM OS Concept & Direction:</strong> The core concept for the Dungeon Master, its personality, rules, and the overall vision for this app were designed by the Creator.</li>
                        <li><strong>Application Code:</strong> The web application you are using—the user interface, buttons, and all visual elements—was written entirely by an AI partner.</li>
                        <li><strong>Core Reasoning Engine (WFGY):</strong> The advanced WFGY system, which gives the DM its long-term memory and self-healing capabilities via the Semantic Tree, is based on the foundational work of <a href="https://github.com/onestardao" target="_blank" rel="noopener noreferrer">onestardao</a>. This project was made possible by their ideas, which you can explore at <a href="https://github.com/onestardao/WFGY" target="_blank" rel="noopener noreferrer">The WFGY Project on GitHub</a>.</li>
                    </ul>
                </section>
            </div>
        </div>
    </div>

    <div id="dnd-help-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <header class="modal-header">
                <h2>D&D Basics & Hints</h2>
                <button id="close-dnd-help-btn" class="close-modal-btn" aria-label="Close help">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                </button>
            </header>
            <div class="modal-body">
                <section>
                    <h3>The Dice of Destiny</h3>
                    <p>Dungeons & Dragons uses a set of polyhedral dice, each referred to by the letter "d" followed by the number of sides. Here are the most common ones:</p>
                    <ul>
                        <li><strong>d4 (4-sided):</strong> Often used for small weapon damage (like a dagger) or certain spells.</li>
                        <li><strong>d6 (6-sided):</strong> The classic cube. Used for many weapon damages, healing spells, and rolling character stats.</li>
                        <li><strong>d8 (8-sided):</strong> Common for martial weapon damage (like a longsword) and many spells.</li>
                        <li><strong>d10 (10-sided):</strong> Used for heavier weapons and some spells. Also used for percentile rolls (d100) with a second d10.</li>
                        <li><strong>d12 (12-sided):</strong> The signature die for the Barbarian's greataxe and other powerful weapons.</li>
                        <li><strong>d20 (20-sided):</strong> The most important die. You roll a d20 for almost every action where the outcome is uncertain: attack rolls, ability checks (like picking a lock or persuading a guard), and saving throws to resist effects.</li>
                    </ul>
                </section>
                 <section>
                    <h3>Stuck? Get a Hint</h3>
                    <p>If you're unsure what to do next, you can ask the Dungeon Master for a hint directly in the chat. The DM will provide a subtle nudge based on your current situation to help you move forward without spoiling the solution.</p>
                    <p>Simply type something like <strong>"I'm stuck, can I get a hint?"</strong> into the chat prompt.</p>
                </section>
            </div>
        </div>
    </div>
    
    <div id="logbook-modal" class="modal-overlay" style="display: none;">
      <div class="modal-content wide-modal">
        <header class="modal-header">
          <h2>Log Book</h2>
          <button id="close-logbook-btn" class="close-modal-btn" aria-label="Close log book">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
          </button>
        </header>
        <div class="logbook-body">
            <nav class="logbook-nav">
                <button class="logbook-nav-btn active" data-tab="character-sheet">Character</button>
                <button class="logbook-nav-btn" data-tab="inventory">Inventory</button>
                <button class="logbook-nav-btn" data-tab="quests">Quests</button>
                <button class="logbook-nav-btn" data-tab="npcs">NPCs</button>
                <button class="logbook-nav-btn" data-tab="achievements">Achievements</button>
                <button class="logbook-nav-btn" data-tab="settings">Settings</button>
            </nav>
            <main class="logbook-content">
                <div id="character-sheet-content" class="logbook-pane active">
                    <div id="character-sheet-display" class="character-sheet">
                      <div class="sheet-placeholder">
                        <p>No data. Click below to generate your character sheet from the adventure log.</p>
                      </div>
                      <!-- Character Sheet data will be rendered here by JS -->
                    </div>
                    <button id="update-sheet-btn" class="logbook-update-btn">Request Update from DM</button>
                </div>

                <div id="inventory-content" class="logbook-pane">
                    <h3>Inventory</h3>
                    <div class="logbook-data-container" id="inventory-display">
                        <p>No data. Ask the DM to summarize your inventory.</p>
                    </div>
                    <button id="update-inventory-btn" class="logbook-update-btn">Request Update from DM</button>
                </div>
                
                <div id="quests-content" class="logbook-pane">
                    <h3>Quest Journal</h3>
                    <div class="logbook-data-container" id="quests-display">
                        <p>No quest data. Ask the DM to update your journal.</p>
                    </div>
                    <button id="update-quests-btn" class="logbook-update-btn">Update Quest Log</button>
                </div>

                <div id="npcs-content" class="logbook-pane">
                    <h3>Dramatis Personae (NPCs)</h3>
                    <div class="logbook-data-container" id="npcs-display">
                        <p>No NPC data. Ask the DM for a list of characters you've met.</p>
                    </div>
                    <button id="update-npcs-btn" class="logbook-update-btn">Update NPC List</button>
                </div>
                
                <div id="achievements-content" class="logbook-pane">
                    <h3>Achievements</h3>
                    <div class="logbook-data-container" id="achievements-display">
                        <!-- Achievements will be rendered here -->
                    </div>
                    <button id="update-achievements-btn" class="logbook-update-btn">Generate Achievements</button>
                </div>

                <div id="settings-content" class="logbook-pane">
                     <h3>Character Image</h3>
                    <div class="character-image-container">
                        <img id="character-image-display" src="" alt="Generated character portrait" class="hidden"/>
                        <div id="character-image-placeholder">
                            <p>Generate a unique portrait for your character based on your adventure.</p>
                             <button id="generate-image-btn" class="logbook-update-btn">Generate Character Image</button>
                        </div>
                        <div id="character-image-loading" class="hidden">
                            <p>First, creating a detailed description of your character...</p>
                            <p>Then, generating the portrait. This may take a moment.</p>
                            <div class="spinner"></div>
                        </div>
                    </div>
                    <div class="settings-separator"></div>
                    <h3>Appearance</h3>
                    <button id="change-ui-btn" class="logbook-update-btn">Change Theme</button>
                    <div class="settings-separator"></div>
                    <h3>Interface Settings</h3>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>Font Size</label>
                            <div id="font-size-controls" class="setting-button-group">
                                <button data-size="small">Small</button>
                                <button data-size="medium">Medium</button>
                                <button data-size="large">Large</button>
                            </div>
                        </div>
                        <div class="setting-item">
                            <label for="setting-enter-send">Press Enter to Send</label>
                            <label class="switch">
                                <input type="checkbox" id="setting-enter-send">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <label for="setting-experimental-upload">Experimental 75MB Upload Limit</label>
                            <label class="switch">
                                <input type="checkbox" id="setting-experimental-upload">
                                <span class="slider round"></span>
                            </label>
                            <p class="setting-description">Warning: May cause browser instability with large files. Default limit is 50MB.</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
      </div>
    </div>
    
    <div id="rename-modal" class="modal-overlay" style="display: none;">
      <div class="modal-content" style="max-width: 400px;">
        <header class="modal-header">
          <h2>Rename Chat</h2>
          <button id="close-rename-btn" class="close-modal-btn" aria-label="Close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
          </button>
        </header>
        <form id="rename-form">
            <div class="modal-body">
                <label for="rename-input" class="sr-only">New chat name</label>
                <input type="text" id="rename-input" placeholder="Enter new name..." required />
            </div>
            <footer class="modal-footer">
                <button type="submit" class="logbook-update-btn">Save</button>
            </footer>
        </form>
      </div>
    </div>

    <div id="delete-confirm-modal" class="modal-overlay" style="display: none;">
      <div class="modal-content" style="max-width: 450px;">
        <header class="modal-header">
          <h2>Delete Chat?</h2>
          <button id="close-delete-confirm-btn" class="close-modal-btn" aria-label="Close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
          </button>
        </header>
        <div class="modal-body">
            <p>Are you sure you want to permanently delete the chat "<strong id="delete-chat-name"></strong>"? This action cannot be undone.</p>
        </div>
        <footer class="modal-footer">
            <button id="cancel-delete-btn" class="modal-footer-btn btn-secondary">Cancel</button>
            <button id="confirm-delete-btn" class="modal-footer-btn btn-danger">Delete</button>
        </footer>
      </div>
    </div>

    <div id="theme-modal" class="modal-overlay" style="display: none;">
      <div class="modal-content wide-modal">
        <header class="modal-header">
          <h2>Change Theme</h2>
          <button id="close-theme-btn" class="close-modal-btn" aria-label="Close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
          </button>
        </header>
        <div class="modal-body">
          <div id="theme-grid" class="theme-grid">
            <!-- Theme cards will be rendered here by JS -->
          </div>
        </div>
      </div>
    </div>
    
    <div id="dice-modal" class="modal-overlay" style="display: none;">
      <div class="modal-content">
        <header class="modal-header">
          <h2>Dice Pouch</h2>
          <button id="close-dice-btn" class="close-modal-btn" aria-label="Close dice pouch">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
          </button>
        </header>
        <div class="modal-body dice-modal-body">
            <div id="dice-grid" class="dice-grid">
              <!-- Dice will be generated by JS -->
            </div>
            <div class="dice-results-area">
                <div class="dice-results-header">
                    <h3>Results Log</h3>
                    <button id="clear-results-btn">Clear</button>
                </div>
                <div id="dice-results-log">
                  <!-- Roll results will be appended here -->
                </div>
                <div class="dice-results-total">
                    <span>Total:</span>
                    <span id="dice-total-value">0</span>
                </div>
            </div>
        </div>
      </div>
    </div>
    
    <ul id="chat-options-menu" class="chat-options-menu" style="display: none;" role="menu">
    </ul>

  </body>
</html>